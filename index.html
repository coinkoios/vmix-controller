<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta http-equiv="Content-Security-Policy" content="default-src 'self' 'unsafe-inline' 'unsafe-eval' http: https: ws: wss: data: blob:;">
    <meta http-equiv="Access-Control-Allow-Origin" content="*">
    <meta http-equiv="Access-Control-Allow-Methods" content="GET, POST, OPTIONS">
    <meta http-equiv="Access-Control-Allow-Headers" content="Content-Type">
    <title>vMix PowerPoint Controller</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: Arial, sans-serif;
            background: #1a1a1a;
            color: white;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        .header {
            background: #2d2d2d;
            padding: 1rem;
            text-align: center;
            border-bottom: 1px solid #3d3d3d;
        }

        .main-content {
            flex: 1;
            display: flex;
            padding: 2rem;
            gap: 2rem;
        }

        .preview-section {
            flex: 3;
            background: #2d2d2d;
            border-radius: 8px;
            padding: 1rem;
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .preview-image {
            width: 100%;
            aspect-ratio: 16/9;
            background: #1a1a1a;
            border: 1px solid #3d3d3d;
            border-radius: 4px;
        }

        .controls-section {
            flex: 1;
            background: #2d2d2d;
            border-radius: 8px;
            padding: 1rem;
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .slide-controls {
            display: flex;
            gap: 1rem;
            justify-content: center;
        }

        button {
            background: #4a4a4a;
            color: white;
            border: none;
            padding: 1rem 2rem;
            border-radius: 4px;
            cursor: pointer;
            font-size: 1rem;
            transition: background 0.2s;
        }

        button:hover {
            background: #5a5a5a;
        }

        button:active {
            background: #3a3a3a;
        }

        .status {
            padding: 0.5rem;
            text-align: center;
            border-radius: 4px;
        }

        .status.connected {
            background: #1c4c1c;
        }

        .status.disconnected {
            background: #4c1c1c;
        }

        .slide-info {
            text-align: center;
            font-size: 1.2rem;
        }

        .return-feed {
            width: 100%;
            aspect-ratio: 16/9;
            background: #1a1a1a;
            border: 1px solid #3d3d3d;
            border-radius: 4px;
            margin-top: 1rem;
        }

        .checklist {
            margin: 10px;
            padding: 10px;
            background: #333;
            border-radius: 4px;
        }

        .checklist ul {
            list-style: none;
            padding: 0;
        }

        .checklist li {
            margin: 5px 0;
            padding: 5px;
            background: #444;
            border-radius: 2px;
        }

        .vmix-call-frame {
            width: 100%;
            aspect-ratio: 16/9;
            background: #1a1a1a;
            border: 1px solid #3d3d3d;
            border-radius: 4px;
        }

        .network-status {
            position: fixed;
            top: 10px;
            right: 10px;
            display: flex;
            align-items: center;
            gap: 8px;
            background: rgba(0,0,0,0.8);
            padding: 8px;
            border-radius: 4px;
        }

        .status-indicator {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: yellow;
        }

        .status-indicator.connected {
            background: #4CAF50;
        }

        .status-indicator.disconnected {
            background: #f44336;
        }

        .status-text {
            font-size: 14px;
            color: white;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>vMix PowerPoint Controller</h1>
        <div id="user-info" style="font-size: 0.9em; margin-top: 5px;"></div>
    </div>

    <div class="main-content">
        <div class="preview-section">
            <h2>vMix Call</h2>
            <!-- vMix Call will be embedded here -->
            <iframe id="vmix-call-frame" class="vmix-call-frame" frameborder="0" allow="camera;microphone;fullscreen"></iframe>
        </div>

        <div class="controls-section">
            <div id="connection-status" class="status disconnected">Disconnected</div>
            <div class="slide-controls">
                <button id="prev-slide">Previous Slide</button>
                <button id="next-slide">Next Slide</button>
            </div>
            <div id="slide-info" class="slide-info">Slide 0 of 0</div>
        </div>
    </div>

    <div class="network-status">
        <div class="status-indicator"></div>
        <span class="status-text">Checking Connection...</span>
    </div>

    <script>
        class VMixController {
            constructor() {
                this.roles = {
                    HOST: 'host',
                    GUEST: 'guest',
                    PRODUCER: 'producer'
                };

                // Get parameters from URL
                const urlParams = new URLSearchParams(window.location.search);
                this.callKey = urlParams.get('Key');
                this.name = urlParams.get('Name');
                this.role = urlParams.get('Role');
                const producerIP = urlParams.get('ProducerIP');
                
                if (this.callKey && this.name && this.role && producerIP) {
                    // Auto-configure everything
                    localStorage.setItem('producerIp', producerIP);
                    localStorage.setItem('producerPort', '8088');
                    this.vmixHost = `http://${producerIP}:8088`;
                    
                    // Skip the setup dialog and connect immediately
                    this.setupVMixCall();
                    if (this.role !== this.roles.PRODUCER) {
                        this.connect();
                    }
                } else {
                    // Fall back to manual setup dialog
                    this.handleUserRole();
                }
            }

            initializeElements() {
                this.prevButton = document.getElementById('prev-slide');
                this.nextButton = document.getElementById('next-slide');
                this.statusElement = document.getElementById('connection-status');
                this.slideInfo = document.getElementById('slide-info');
                
                // Get vMix Call parameters and role from URL
                const urlParams = new URLSearchParams(window.location.href.split('?')[1] || '');
                this.callKey = urlParams.get('Key');
                this.name = urlParams.get('Name');
                this.role = urlParams.get('Role')?.toLowerCase() || 'guest';
                
                // If no parameters in URL, try to get from localStorage
                if (!this.callKey || !this.name) {
                    this.showCallSetupDialog();
                } else {
                    this.setupVMixCall();
                }
            }

            showCallSetupDialog() {
                const dialog = document.createElement('div');
                dialog.style.cssText = `
                    position: fixed;
                    top: 50%;
                    left: 50%;
                    transform: translate(-50%, -50%);
                    background: #2d2d2d;
                    padding: 20px;
                    border-radius: 8px;
                    z-index: 1000;
                    box-shadow: 0 0 20px rgba(0,0,0,0.5);
                `;

                dialog.innerHTML = `
                    <h3 style="margin-bottom: 15px;">vMix Call Setup</h3>
                    <div style="margin-bottom: 10px;">
                        <label>Call Code:</label>
                        <input type="text" id="call-key" placeholder="Enter vMix Call code" style="width: 150px; padding: 5px;">
                    </div>
                    <div style="margin-bottom: 10px;">
                        <label>Your Name:</label>
                        <input type="text" id="user-name" placeholder="Enter your name" style="width: 150px; padding: 5px;">
                    </div>
                    <div style="margin-bottom: 15px;">
                        <label>Role:</label>
                        <select id="user-role" style="width: 150px; padding: 5px;">
                            <option value="guest">Guest</option>
                            <option value="host">Host</option>
                            <option value="producer">Producer</option>
                        </select>
                    </div>
                    <div style="text-align: right;">
                        <button id="setup-btn" style="padding: 8px 15px; background: #4a4a4a; border: none; color: white; border-radius: 4px; cursor: pointer;">Connect</button>
                    </div>
                `;

                document.body.appendChild(dialog);

                document.getElementById('setup-btn').onclick = () => {
                    const key = document.getElementById('call-key').value;
                    const name = document.getElementById('user-name').value;
                    const role = document.getElementById('user-role').value;

                    if (key && name) {
                        // Save to localStorage for future use
                        localStorage.setItem('vmixCallKey', key);
                        localStorage.setItem('vmixCallName', name);
                        localStorage.setItem('vmixCallRole', role);

                        // Update URL with parameters
                        const newUrl = new URL(window.location.href);
                        newUrl.searchParams.set('Key', key);
                        newUrl.searchParams.set('Name', name);
                        newUrl.searchParams.set('Role', role);
                        window.history.pushState({}, '', newUrl);

                        this.callKey = key;
                        this.name = name;
                        this.role = role;
                        
                        document.body.removeChild(dialog);
                        this.setupVMixCall();
                    }
                };
            }

            setupVMixCall() {
                const vmixCallFrame = document.getElementById('vmix-call-frame');
                const callUrl = `https://advanced.vmixcall.com/call.htm?Key=${this.callKey}&Name=${this.name}`;
                console.log('Setting vMix Call URL:', callUrl);
                vmixCallFrame.src = callUrl;

                // Update user info display
                const userInfo = document.getElementById('user-info');
                userInfo.textContent = `Connected as: ${this.name} (${this.role})`;

                // Only show vMix connection dialog for producers
                if (this.role === this.roles.PRODUCER) {
                    this.promptForConnection();
                } else if (this.role === this.roles.GUEST || this.role === this.roles.HOST) {
                    // For hosts and guests, try to connect using stored producer settings
                    const producerIp = localStorage.getItem('producerIp');
                    const producerPort = localStorage.getItem('producerPort');
                    if (producerIp && producerPort) {
                        this.vmixHost = `http://${producerIp}:${producerPort}`;
                        this.initializeEventListeners();
                        this.connect();
                    } else {
                        this.statusElement.textContent = 'Waiting for Producer Settings';
                    }
                }
            }

            hideSlideControls() {
                const controlsSection = document.querySelector('.controls-section');
                controlsSection.style.display = 'none';
            }

            promptForConnection() {
                const savedIp = localStorage.getItem('producerIp') || '192.168.2.47';
                const savedPort = localStorage.getItem('producerPort') || '8088';
                
                // Verify IP is valid
                const isValidIp = (ip) => {
                    const parts = ip.split('.');
                    return parts.length === 4 && parts.every(part => {
                        const num = parseInt(part);
                        return num >= 0 && num <= 255;
                    });
                };
                
                const dialog = document.createElement('div');
                dialog.style.cssText = `
                    position: fixed;
                    top: 50%;
                    left: 50%;
                    transform: translate(-50%, -50%);
                    background: #2d2d2d;
                    padding: 20px;
                    border-radius: 8px;
                    z-index: 1000;
                    box-shadow: 0 0 20px rgba(0,0,0,0.5);
                `;

                dialog.innerHTML = `
                    <h3 style="margin-bottom: 15px;">Connect to vMix</h3>
                    <div style="margin-bottom: 10px;">
                        <label>IP Address:</label>
                        <input type="text" id="vmix-ip" value="${savedIp}" style="width: 150px; padding: 5px;">
                    </div>
                    <div style="margin-bottom: 15px;">
                        <label>Port:</label>
                        <input type="text" id="vmix-port" value="${savedPort}" style="width: 150px; padding: 5px;">
                    </div>
                    <div style="text-align: right;">
                        <button id="connect-btn" style="padding: 8px 15px; background: #4a4a4a; border: none; color: white; border-radius: 4px; cursor: pointer;">Connect</button>
                    </div>
                `;

                document.body.appendChild(dialog);

                document.getElementById('connect-btn').onclick = async () => {
                    const ip = document.getElementById('vmix-ip').value;
                    const port = document.getElementById('vmix-port').value;

                    if (!isValidIp(ip)) {
                        alert('Invalid IP Address');
                        return;
                    }

                    if (ip && port) {
                        try {
                            const testUrl = `http://${ip}:${port}/api/`;
                            const response = await fetch(testUrl, {
                                mode: 'no-cors',
                                cache: 'no-cache'
                            });
                            
                            // If we get here, connection worked
                            localStorage.setItem('producerIp', ip);
                            localStorage.setItem('producerPort', port);
                            this.vmixHost = `http://${ip}:${port}`;
                            document.body.removeChild(dialog);
                            this.initializeEventListeners();
                            this.connect();
                        } catch (error) {
                            alert('Could not connect to vMix at that address. Please verify:\n1. vMix is running\n2. IP address is correct\n3. Port 8088 is open');
                        }
                    }
                };
            }

            async connect() {
                try {
                    console.log('Attempting to connect to vMix API at:', this.vmixHost);
                    
                    // Use a CORS proxy for GitHub Pages
                    const proxyUrl = 'https://cors-anywhere.herokuapp.com/';
                    const vmixUrl = `${this.vmixHost}/api/`;
                    
                    const response = await fetch(proxyUrl + vmixUrl, {
                        headers: {
                            'Origin': window.location.origin,
                            'X-Requested-With': 'XMLHttpRequest'
                        }
                    });

                    if (response.ok) {
                        this.statusElement.textContent = 'Connected';
                        this.statusElement.style.backgroundColor = '#4CAF50';
                        this.connected = true;
                        
                        // Start polling for PowerPoint updates
                        this.startPolling();
                    }
                } catch (error) {
                    console.error('Error connecting to vMix:', error);
                    this.statusElement.textContent = 'Connection Failed';
                    this.statusElement.style.backgroundColor = '#f44336';
                }
            }

            startPolling() {
                // Poll every second for updates
                this.pollInterval = setInterval(() => {
                    this.updateSlideInfo();
                }, 1000);
            }

            initializeEventListeners() {
                this.prevButton.addEventListener('click', () => this.previousSlide());
                this.nextButton.addEventListener('click', () => this.nextSlide());
            }

            async updateSlideInfo() {
                try {
                    const proxyUrl = 'https://cors-anywhere.herokuapp.com/';
                    const response = await fetch(proxyUrl + `${this.vmixHost}/api/`, {
                        headers: {
                            'Origin': window.location.origin,
                            'X-Requested-With': 'XMLHttpRequest'
                        }
                    });
                    
                    const text = await response.text();
                    const parser = new DOMParser();
                    const xmlDoc = parser.parseFromString(text, "text/xml");
                    
                    const input = xmlDoc.querySelector(`input[number="${this.powerPointInput}"]`);
                    if (input) {
                        const title = input.getAttribute('title') || '';
                        const slideMatch = title.match(/Slide\s*(\d+)/i);
                        // Get total slides from PowerPoint input
                        const powerPointInput = xmlDoc.querySelector('input[type="PowerPoint"]');
                        const totalSlides = powerPointInput ? '10' : '0';

                        if (slideMatch) {
                            const currentSlide = slideMatch[1];
                            this.slideInfo.textContent = `Slide ${currentSlide} of ${totalSlides}`;
                        } else {
                            this.slideInfo.textContent = title;
                        }
                        
                        console.log('PowerPoint info:', {
                            title,
                            currentSlide: slideMatch ? slideMatch[1] : 'unknown',
                            totalSlides
                        });
                    }
                } catch (error) {
                    console.error('Error updating slide info:', error);
                }
            }

            async nextSlide() {
                if (!this.powerPointInput) return;
                try {
                    const proxyUrl = 'https://cors-anywhere.herokuapp.com/';
                    const response = await fetch(proxyUrl + `${this.vmixHost}/api/?Function=NextItem&Input=${this.powerPointInput}`, {
                        headers: {
                            'Origin': window.location.origin,
                            'X-Requested-With': 'XMLHttpRequest'
                        }
                    });
                    
                    console.log('Next slide command sent');
                    await this.updateSlideInfo();
                } catch (error) {
                    console.error('Error advancing slide:', error);
                }
            }

            async previousSlide() {
                if (!this.powerPointInput) return;
                try {
                    const proxyUrl = 'https://cors-anywhere.herokuapp.com/';
                    const response = await fetch(proxyUrl + `${this.vmixHost}/api/?Function=PreviousItem&Input=${this.powerPointInput}`, {
                        headers: {
                            'Origin': window.location.origin,
                            'X-Requested-With': 'XMLHttpRequest'
                        }
                    });
                    
                    console.log('Previous slide command sent');
                    await this.updateSlideInfo();
                } catch (error) {
                    console.error('Error going back one slide:', error);
                }
            }

            async setupRemoteAccess() {
                try {
                    // Get public IP
                    const response = await fetch('https://api.ipify.org?format=json');
                    const data = await response.json();
                    this.publicIp = data.ip;
                    
                    if (this.role === this.roles.PRODUCER) {
                        // Create shareable links for hosts and guests
                        const baseUrl = window.location.origin + window.location.pathname;
                        
                        const shareDialog = document.createElement('div');
                        shareDialog.style.cssText = `
                            position: fixed;
                            top: 50%;
                            left: 50%;
                            transform: translate(-50%, -50%);
                            background: #2d2d2d;
                            padding: 20px;
                            border-radius: 8px;
                            z-index: 1001;
                            box-shadow: 0 0 20px rgba(0,0,0,0.5);
                            max-width: 80%;
                            width: 600px;
                        `;
                        
                        // Create links for both host and guest
                        const hostLink = `${baseUrl}?Key=${this.callKey}&Name=HOST&Role=host&ProducerIP=${this.publicIp}&ProducerPort=8088`;
                        const guestLink = `${baseUrl}?Key=${this.callKey}&Name=GUEST&Role=guest&ProducerIP=${this.publicIp}&ProducerPort=8088`;
                        
                        shareDialog.innerHTML = `
                            <h3>Remote Access Links</h3>
                            <p style="color: #ff9999; margin: 10px 0;">Important: Make sure port 8088 is forwarded to this computer!</p>
                            ${this.generateCallLinks()}
                            <div style="margin-top: 20px;">
                                <p>Test your setup: <a href="http://${this.publicIp}:8088/api/" target="_blank">Click here</a></p>
                                <button onclick="this.parentElement.remove()" style="margin-top: 10px;">Close</button>
                            </div>
                        `;
                        
                        document.body.appendChild(shareDialog);
                    }
                } catch (error) {
                    console.error('Error setting up remote access:', error);
                }
            }

            generateCallLinks() {
                const callCodes = {
                    hosts: [
                        { code: '5291486963', name: 'Host1' },
                        { code: '2362872170', name: 'Host2' },
                        { code: '4495848015', name: 'Host3' }
                    ],
                    guests: [
                        { code: '3118728628', name: 'Guest1' },
                        { code: '3199515614', name: 'Guest2' }
                    ],
                    producers: [
                        { code: '3729675049', name: 'Producer1' },
                        { code: '2085058768', name: 'Producer2' },
                        { code: '1889937177', name: 'Producer3' }
                    ]
                };

                // Use the correct vMix Call domain
                const baseUrl = 'https://advanced.vmixcall.com/vmix-interface-v1.html';
                let linksHtml = '';

                // Generate Host Links
                linksHtml += '<h4>Host Links:</h4>';
                callCodes.hosts.forEach(host => {
                    // Create direct vMix Call link
                    const vmixCallLink = `https://advanced.vmixcall.com/call.htm?Key=${host.code}&Name=${host.name}`;
                    // Create controller link
                    const controllerLink = `${baseUrl}?Key=${host.code}&Name=${host.name}&Role=host&ProducerIP=${this.publicIp}&ProducerPort=8088`;
                    
                    linksHtml += `
                        <div style="margin: 10px 0;">
                            <p>${host.name}:</p>
                            <div style="margin: 5px 0;">
                                <p>Direct vMix Call Link:</p>
                                <input type="text" value="${vmixCallLink}" style="width: 100%; padding: 5px;" readonly>
                                <button onclick="navigator.clipboard.writeText('${vmixCallLink}').then(() => alert('${host.name} vMix Call link copied!'))">
                                    Copy vMix Call Link
                                </button>
                            </div>
                            <div style="margin: 5px 0;">
                                <p>Controller Link:</p>
                                <input type="text" value="${controllerLink}" style="width: 100%; padding: 5px;" readonly>
                                <button onclick="navigator.clipboard.writeText('${controllerLink}').then(() => alert('${host.name} controller link copied!'))">
                                    Copy Controller Link
                                </button>
                            </div>
                        </div>
                    `;
                });

                // Generate Guest Links
                linksHtml += '<h4>Guest Links:</h4>';
                callCodes.guests.forEach(guest => {
                    // For guests, only create direct vMix Call link
                    const vmixCallLink = `https://advanced.vmixcall.com/call.htm?Key=${guest.code}&Name=${guest.name}`;
                    
                    linksHtml += `
                        <div style="margin: 10px 0;">
                            <p>${guest.name}:</p>
                            <input type="text" value="${vmixCallLink}" style="width: 100%; padding: 5px;" readonly>
                            <button onclick="navigator.clipboard.writeText('${vmixCallLink}').then(() => alert('${guest.name} link copied!'))">
                                Copy Link
                            </button>
                        </div>
                    `;
                });

                // Add instructions at the top
                linksHtml = `
                    <div style="margin-bottom: 20px; padding: 10px; background: #333; border-radius: 4px;">
                        <h4>Instructions:</h4>
                        <p>1. For Hosts: Send them:</p>
                        <ul>
                            <li>This HTML file</li>
                            <li>Their vMix Call code below</li>
                            <li>Your IP address: ${this.publicIp}</li>
                        </ul>
                        <p>2. For Guests: Just send them their vMix Call link</p>
                    </div>
                ` + linksHtml;

                return linksHtml;
            }

            async setupConnection() {
                const port = '8088';
                const savedIp = localStorage.getItem('producerIp');
                
                try {
                    // If we have a saved producer IP, try that first
                    if (savedIp) {
                        try {
                            await this.testConnection(savedIp, port);
                            this.vmixHost = `http://${savedIp}:${port}`;
                            this.connect();
                            return;
                        } catch (err) {
                            console.log('Saved IP failed, trying local...');
                        }
                    }

                    // Try local network connection
                    const localIps = [
                        '192.168.2.47',  // Your specific IP
                        '127.0.0.1',     // Localhost
                        'localhost'      // Hostname
                    ];

                    for (const ip of localIps) {
                        try {
                            await this.testConnection(ip, port);
                            this.vmixHost = `http://${ip}:${port}`;
                            this.connect();
                            return;
                        } catch (err) {
                            console.log(`${ip} failed, trying next...`);
                        }
                    }

                    // If all local attempts fail, try public IP
                    const publicIp = await this.getPublicIp();
                    await this.testConnection(publicIp, port);
                    this.vmixHost = `http://${publicIp}:${port}`;
                    this.connect();

                } catch (error) {
                    console.error('All connection attempts failed:', error);
                    this.statusElement.textContent = 'Connection Failed - Check Network Settings';
                    this.showConnectionHelp();
                }
            }

            async testConnection(ip, port) {
                const response = await fetch(`http://${ip}:${port}/api/`, {
                    mode: 'no-cors',
                    timeout: 5000
                });
                return response;
            }

            showConnectionHelp() {
                const helpDialog = document.createElement('div');
                helpDialog.innerHTML = `
                    <div style="background: #2d2d2d; padding: 20px; border-radius: 8px; max-width: 600px; margin: 20px auto;">
                        <h3>Connection Troubleshooting</h3>
                        <ol style="margin-left: 20px; line-height: 1.4;">
                            <li>Verify vMix is running on the producer's computer</li>
                            <li>Check your network connection</li>
                            <li>For remote access, ensure:
                                <ul>
                                    <li>Port 8088 is forwarded on the producer's router</li>
                                    <li>Producer's firewall allows vMix connections</li>
                                    <li>Producer has shared their public IP address</li>
                                </ul>
                            </li>
                        </ol>
                        <div style="margin-top: 15px;">
                            <button onclick="this.parentElement.parentElement.remove()">Close</button>
                        </div>
                    </div>
                `;
                document.body.appendChild(helpDialog);
            }

            async getPublicIp() {
                const response = await fetch('https://api.ipify.org?format=json');
                const data = await response.json();
                return data.ip;
            }

            showProducerGuide() {
                const guide = document.createElement('div');
                guide.innerHTML = `
                    <div style="background: #2d2d2d; padding: 20px; border-radius: 8px; max-width: 800px; margin: 20px auto;">
                        <h3>Producer Setup Guide</h3>
                        <div style="margin: 15px 0;">
                            <h4>1. Router Configuration</h4>
                            <ol>
                                <li>Access your router's admin panel (usually http://192.168.1.1)</li>
                                <li>Find "Port Forwarding" settings</li>
                                <li>Add a new rule:
                                    <ul>
                                        <li>External Port: 8088</li>
                                        <li>Internal Port: 8088</li>
                                        <li>Protocol: TCP</li>
                                        <li>Internal IP: ${this.vmixHost?.split(':')[1].slice(2)}</li>
                                    </ul>
                                </li>
                            </ol>
                        </div>
                        <div style="margin: 15px 0;">
                            <h4>2. Firewall Settings</h4>
                            <ol>
                                <li>Open Windows Defender Firewall</li>
                                <li>Click "Allow an app through firewall"</li>
                                <li>Find vMix in the list or add it manually</li>
                                <li>Ensure both Private and Public networks are checked</li>
                            </ol>
                        </div>
                        <div style="margin: 15px 0;">
                            <h4>3. Share Connection Details</h4>
                            <p>Send these details to remote users:</p>
                            <ul>
                                <li>Public IP: ${this.publicIp}</li>
                                <li>Port: 8088</li>
                                <li>Their unique vMix Call link (from the links dialog)</li>
                            </ul>
                        </div>
                        <button onclick="this.parentElement.parentElement.remove()">Close Guide</button>
                    </div>
                `;
                document.body.appendChild(guide);
            }
        }

        // Initialize when page loads
        window.addEventListener('load', () => new VMixController());
    </script>
</body>
</html>
